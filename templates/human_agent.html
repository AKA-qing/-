{% extends "base.html" %}
{% block title %}äººå·¥å’¨è¯¢{% endblock %}

{% block content %}
<style>
    .chat-container {
        max-width: 800px;
        margin: 60px auto;
        background: #fffef4;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
        overflow: hidden;
        padding: 30px;
    }

    .chat-box {
        max-height: 500px;
        overflow-y: auto;
        padding: 20px;
        background-color: #fffcf0;
        border-radius: 15px;
        border: 1px solid #fff3c0;
        margin-bottom: 20px;
    }

    .message {
        margin-bottom: 15px;
        display: flex;
    }

    .message-content {
        padding: 12px 18px;
        border-radius: 15px;
        max-width: 70%;
        font-size: 1rem;
        line-height: 1.5;
        word-wrap: break-word;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
    }

/* ç”¨æˆ·æ¶ˆæ¯ï¼šé å·¦ */
.user .message-content {
    background: #fff9c4;
    color: #5c4500;
    margin-right: auto; /* â† é å·¦æ˜¾ç¤º */
}

/* å’¨è¯¢å¸ˆæ¶ˆæ¯ï¼šé å³ */
.bot .message-content {
    background: #e8f5e9;
    color: #2e7d32;
    margin-left: auto;  /* â†’ é å³æ˜¾ç¤º */
}


    .input-area {
        display: flex;
        gap: 10px;
    }

    #agent-input {
        flex: 1;
        padding: 12px;
        border-radius: 12px;
        border: 1px solid #f0d57e;
        background: #fffef4;
    }

    button {
        background: #f4b400;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 12px;
        font-weight: bold;
        transition: 0.3s ease;
    }

    button:hover {
        background: #e0a800;
    }

    /* åˆå§‹å¼¹çª—æç¤º */
    #welcomeModal {
        position: fixed;
        top: 0; left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(255, 245, 200, 0.9);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
    }

    .welcome-content {
        background: #fff8dc;
        padding: 40px 50px;
        border-radius: 20px;
        border-left: 6px solid #ffd54f;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        text-align: center;
        max-width: 500px;
        color: #5a3e00;
    }
</style>
<div class="quick-replies mt-4 mb-3">
    <h5 class="text-warning-emphasis mb-2">ğŸ’¡ å¿«æ·å›å¤æ¨è</h5>
    <div class="d-flex flex-wrap gap-2">
        <button class="btn btn-outline-warning btn-sm rounded-pill" onclick="insertQuickReply('ç„¦è™‘æ˜¯ä¸€ç§å¸¸è§ååº”ï¼Œè¯·å…è®¸è‡ªå·±æ…¢æ…¢è°ƒæ•´ï¼Œæˆ‘ä»¬ä¸€èµ·æ¢ç´¢ç¼“è§£çš„æ–¹å¼ã€‚')">ç„¦è™‘</button>
        <button class="btn btn-outline-warning btn-sm rounded-pill" onclick="insertQuickReply('ä½ å¹¶ä¸å­¤å•ï¼Œæˆ‘ä¼šé™ªç€ä½ å€¾å¬ä¸æ”¯æŒã€‚')">å­¤ç‹¬</button>
        <button class="btn btn-outline-warning btn-sm rounded-pill" onclick="insertQuickReply('ç¡çœ é—®é¢˜å¸¸å¸¸å’Œå‹åŠ›æœ‰å…³ï¼Œä¹Ÿè®¸å¯ä»¥è¯•è¯•å‘¼å¸æ”¾æ¾æˆ–å†¥æƒ³å“¦~')">å¤±çœ </button>
        <button class="btn btn-outline-warning btn-sm rounded-pill" onclick="insertQuickReply('æƒ…ç»ªæœ‰æ³¢åŠ¨å¾ˆæ­£å¸¸ï¼Œé‡è¦çš„æ˜¯ä½ æ„¿æ„é¢å¯¹å®ƒï¼Œæˆ‘ä»¬ä¸€èµ·æ…¢æ…¢æ¥ã€‚')">ä½è½</button>
        <button class="btn btn-outline-warning btn-sm rounded-pill" onclick="insertQuickReply('æ„¿æ„å¬ä½ æ…¢æ…¢è®²ï¼Œæ— è®ºä½ å¤„åœ¨ä»€ä¹ˆæƒ…ç»ªä¸­ï¼Œè¿™é‡Œéƒ½å¾ˆå®‰å…¨ã€‚')">å€¾å¬</button>
    </div>
</div>
<!-- åˆå§‹æ¬¢è¿å¼¹çª— -->
<div id="welcomeModal">
    <div class="welcome-content">
        <h4>ğŸ§ è¿æ¥æˆåŠŸ</h4>
        <p>æ‚¨å·²æ¥å…¥ä¸€ä½ç”¨æˆ·ã€‚<br>è¯·ä»¥æ¸©æŸ”å’Œè€å¿ƒå€¾å¬ï¼Œç»™äºˆä¸“ä¸šçš„å¿ƒç†æ”¯æŒ ğŸ’›</p>
        <button onclick="document.getElementById('welcomeModal').style.display='none'">æˆ‘å‡†å¤‡å¥½äº†</button>
    </div>
</div>

<!-- ä¸»èŠå¤©ç›’å­ -->
<div class="chat-container">
    <div class="chat-box" id="chat-box">
        <div class="message bot">
            <div class="message-content">æœ‰ä¸€åå’¨è¯¢è€…æ¥å…¥ï¼Œè¯·æä¾›å¸®åŠ©ã€‚</div>
        </div>
    </div>

    <div class="input-area">
        <input type="text" id="agent-input" placeholder="è¯·è¾“å…¥æ‚¨çš„å›å¤...">
        <button onclick="sendMessage()">å‘é€</button>
    </div>
</div>

<!-- WebSocketé€»è¾‘ -->
<script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
<script>
    const socket = io.connect('http://' + document.domain + ':' + location.port);
    socket.emit('connect_agent');

    socket.on('new_user_message', function(data) {
        const chatBox = document.getElementById('chat-box');
        const userMessage = document.createElement('div');
        userMessage.className = 'message user';
        userMessage.innerHTML = `<div class="message-content">${data.message}</div>`;
        chatBox.appendChild(userMessage);
        chatBox.scrollTop = chatBox.scrollHeight;
    });

    socket.on('new_agent_reply', function(data) {
        const chatBox = document.getElementById('chat-box');
        const botMessage = document.createElement('div');
        botMessage.className = 'message bot';
        botMessage.innerHTML = `<div class="message-content">${data.reply}</div>`;
        chatBox.appendChild(botMessage);
        chatBox.scrollTop = chatBox.scrollHeight;
    });

    function sendMessage() {
        const agentInput = document.getElementById('agent-input').value.trim();
        if (!agentInput) return;

        const chatBox = document.getElementById('chat-box');
        const agentMessage = document.createElement('div');
        agentMessage.className = 'message bot';
        agentMessage.innerHTML = `<div class="message-content">${agentInput}</div>`;
        chatBox.appendChild(agentMessage);
        socket.emit('agent_reply', { reply: agentInput });
        document.getElementById('agent-input').value = '';
        chatBox.scrollTop = chatBox.scrollHeight;
    }
        function insertQuickReply(text) {
        const inputBox = document.getElementById("agent-input");
        inputBox.value = text;
        inputBox.focus();
    }
</script>
{% endblock %}
